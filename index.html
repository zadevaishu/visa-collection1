<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VISA COLLECTION ‚Ä¢ Premium Fashion Store</title>
<!-- Poppins & Font Awesome -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: #f8f9fa;
      color: #333;
    }

    /* Header & Navigation */
    header {
      background: #000;
      color: #fff;
      padding: 16px 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
    }
    .logo i {
      color: #ff4d6d;
      margin-right: 8px;
    }

    .search-bar {
      flex: 1;
      max-width: 400px;
      margin: 0 20px;
    }

    .search-bar input {
      width: 100%;
      padding: 12px 20px;
      border: none;
      border-radius: 40px;
      font-size: 0.95rem;
      outline: none;
    }

    .nav-right {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .nav-icon {
      background: #333;
      padding: 10px 15px;
      border-radius: 40px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-icon:hover {
      background: #ff4d6d;
    }

    #cart-count, #wishlist-count {
      background: white;
      color: #ff4d6d;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      margin-left: 5px;
    }

    /* Categories Bar */
    .categories-bar {
      background: #fff;
      padding: 15px 5%;
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
      border-bottom: 1px solid #eee;
      position: sticky;
      top: 80px;
      z-index: 99;
    }

    .category-btn {
      background: none;
      border: none;
      font-weight: 500;
      cursor: pointer;
      padding: 5px 0;
      border-bottom: 2px solid transparent;
      transition: 0.2s;
    }

    .category-btn.active {
      border-bottom-color: #ff4d6d;
      color: #ff4d6d;
    }

    .category-btn:hover {
      color: #ff4d6d;
    }

    /* Hero Section */
    .hero {
      height: 60vh;
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1521334884684-d80222895322') no-repeat center/cover;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: #fff;
    }

    .hero-content h2 {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    /* Product Grid */
    .section {
      padding: 40px 5%;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 2rem;
      font-weight: 600;
    }

    .filters {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .filters select {
      padding: 8px 15px;
      border-radius: 30px;
      border: 1px solid #ddd;
      outline: none;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 30px;
    }

    .product-card {
      background: #fff;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      transition: 0.3s;
      position: relative;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }

    .product-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #ff4d6d;
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      z-index: 2;
    }

    .product-badge.out-of-stock {
      background: #6c757d;
    }

    .product-img-container {
      position: relative;
      overflow: hidden;
      height: 280px;
    }

    .product-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: 0.5s;
    }

    .product-card:hover .product-img {
      transform: scale(1.05);
    }

    .product-overlay {
      position: absolute;
      bottom: -50px;
      left: 0;
      right: 0;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
      transition: 0.3s;
    }

    .product-card:hover .product-overlay {
      bottom: 0;
    }

    .overlay-btn {
      background: #ff4d6d;
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .overlay-btn:hover {
      background: #e63e5c;
      transform: scale(1.1);
    }

    .product-info {
      padding: 15px;
    }

    .product-category {
      color: #888;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .product-name {
      font-weight: 600;
      font-size: 1.1rem;
      margin: 5px 0;
    }

    .product-rating {
      color: #ffc107;
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .product-rating span {
      color: #888;
      margin-left: 5px;
    }

    .product-price {
      color: #ff4d6d;
      font-weight: 700;
      font-size: 1.2rem;
    }

    .product-actions {
      display: flex;
      gap: 10px;
      padding: 15px;
      padding-top: 0;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: #ff4d6d;
      color: white;
      flex: 1;
    }

    .btn-primary:hover:not(:disabled) {
      background: #e63e5c;
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid #ff4d6d;
      color: #ff4d6d;
    }

    .btn-outline:hover {
      background: #ff4d6d;
      color: white;
    }

    /* Quick View Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      max-width: 900px;
      width: 90%;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      flex-wrap: wrap;
      position: relative;
      animation: modalSlide 0.3s;
    }

    @keyframes modalSlide {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 2rem;
      cursor: pointer;
      color: #666;
      z-index: 10;
    }

    .modal-img {
      flex: 1;
      min-width: 300px;
      height: 400px;
      object-fit: cover;
    }

    .modal-details {
      flex: 1;
      padding: 30px;
      min-width: 300px;
    }

    /* Size Guide */
    .size-guide {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 20px;
      z-index: 2001;
      max-width: 500px;
      width: 90%;
    }

    .size-guide table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .size-guide th, .size-guide td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    .size-guide th {
      background: #f8f9fa;
    }

    /* Order Tracking */
    .tracking-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
    }

    .tracking-steps {
      display: flex;
      justify-content: space-between;
      margin: 30px 0;
      position: relative;
    }

    .tracking-steps::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background: #ddd;
      z-index: 1;
    }

    .step {
      position: relative;
      z-index: 2;
      background: white;
      padding: 0 10px;
      text-align: center;
    }

    .step.active .step-icon {
      background: #28a745;
      color: white;
    }

    .step-icon {
      width: 30px;
      height: 30px;
      background: #ddd;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 5px;
    }

    /* Coupon */
    .coupon-section {
      background: linear-gradient(135deg, #ff4d6d, #ff8a5c);
      padding: 40px 5%;
      text-align: center;
      color: white;
    }

    .coupon-input {
      display: flex;
      max-width: 400px;
      margin: 20px auto;
    }

    .coupon-input input {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 30px 0 0 30px;
      outline: none;
    }

    .coupon-input button {
      padding: 12px 25px;
      background: #333;
      color: white;
      border: none;
      border-radius: 0 30px 30px 0;
      cursor: pointer;
    }

    /* Recently Viewed */
    .recently-viewed {
      background: #f8f9fa;
      padding: 40px 5%;
    }

    /* Address Book */
    .address-card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      border: 1px solid #ddd;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .search-bar {
        order: 3;
        max-width: 100%;
        margin: 10px 0 0;
      }

      .categories-bar {
        top: 120px;
      }
    }

    /* Auth Modals (from previous) */
    .auth-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
    }

    .auth-card {
      background: white;
      max-width: 420px;
      width: 90%;
      border-radius: 30px;
      padding: 35px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
      position: relative;
    }

    .auth-card input, .auth-card select, .auth-card textarea {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 40px;
      outline: none;
    }
</style>
</head>
<body>

<!-- Header -->
<header>
<div class="logo"><i class="fas fa-crown"></i> VISA‚Ä¢COLLECTION</div>

<div class="search-bar">
<input type="text" id="searchInput" placeholder="üîç Search products...">
</div>

<div class="nav-right">
<div class="nav-icon" id="userIcon">
<i class="fas fa-user"></i><span id="userNameDisplay">Login</span>
</div>
<div class="nav-icon" id="wishlistIcon">
<i class="fas fa-heart"></i><span id="wishlist-count">0</span>
</div>
<div class="nav-icon" id="cartIcon">
<i class="fas fa-shopping-cart"></i><span id="cart-count">0</span>
</div>
</div>
</header>

<!-- Categories -->
<div class="categories-bar">
<button class="category-btn active" data-category="all">All</button>
<button class="category-btn" data-category="jackets">Jackets</button>
<button class="category-btn" data-category="tshirts">T-Shirts</button>
<button class="category-btn" data-category="dresses">Dresses</button>
<button class="category-btn" data-category="jeans">Jeans</button>
<button class="category-btn" data-category="hoodies">Hoodies</button>
<button class="category-btn" data-category="accessories">Accessories</button>
<button class="category-btn" id="sizeGuideBtn"><i class="fas fa-ruler"></i> Size Guide</button>
</div>

<!-- Hero -->
<section class="hero">
<div class="hero-content">
<h2>Summer Sale 2026</h2>
<p>Up to 50% off on premium collections</p>
<button class="btn btn-primary" onclick="document.querySelector('.categories-bar').scrollIntoView({behavior: 'smooth'})">Shop Now</button>
</div>
</section>

<!-- Main Products Section -->
<section class="section">
<div class="section-header">
<h2 class="section-title">Featured Products</h2>
<div class="filters">
<select id="sortSelect">
<option value="default">Sort by: Featured</option>
<option value="price-low">Price: Low to High</option>
<option value="price-high">Price: High to Low</option>
<option value="rating">Top Rated</option>
</select>
</div>
</div>

<div id="guestWarningPlaceholder"></div>
<div class="product-grid" id="productGrid"></div>
</section>

<!-- Coupon Section -->
<section class="coupon-section">
<h3>üéâ First Time Customer?</h3>
<p>Use code <strong>WELCOME20</strong> for 20% off</p>
<div class="coupon-input">
<input type="text" id="couponInput" placeholder="Enter coupon code">
<button id="applyCoupon">Apply</button>
</div>
<div id="couponMessage" style="margin-top: 10px;"></div>
</section>

<!-- Recently Viewed -->
<section class="recently-viewed">
<h3>Recently Viewed</h3>
<div class="product-grid" id="recentlyViewedGrid"></div>
</section>

<!-- Payment Methods -->
<section class="section" style="background: #fff;">
<h3>We Accept</h3>
<div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
<img src="https://img.icons8.com/color/48/visa.png" alt="visa">
<img src="https://img.icons8.com/color/48/mastercard.png" alt="mc">
<img src="https://img.icons8.com/color/48/rupay.png" alt="rupay">
<img src="https://img.icons8.com/color/48/google-pay.png" alt="gpay">
<img src="https://img.icons8.com/color/48/phone-pe.png" alt="phonepe">
</div>
</section>

<!-- Footer -->
<footer style="background: #000; color: #fff; padding: 40px 5%; text-align: center;">
<p>¬© 2026 VISA COLLECTION ‚Ä¢ Premium Fashion Store</p>
<p style="margin-top: 10px;">üìû Customer Support: +91 75584 07044 | ‚úâÔ∏è support@visacollection.com</p>
</footer>

<!-- ========== MODALS ========== -->

<!-- Login Modal -->
<div class="auth-overlay" id="loginModal">
<div class="auth-card">
<span class="close-auth" id="closeLogin" style="position: absolute; top: 15px; right: 20px; font-size: 2rem; cursor: pointer;">&times;</span>
<h2>Login</h2>
<form id="loginForm">
<input type="email" id="loginEmail" placeholder="Email" required>
<input type="password" id="loginPassword" placeholder="Password" required>
<button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
</form>
<p style="text-align: center; margin-top: 15px;">Don't have an account? <span id="showRegister" style="color: #ff4d6d; cursor: pointer;">Register</span></p>
</div>
</div>

<!-- Register Modal -->
<div class="auth-overlay" id="registerModal">
<div class="auth-card">
<span class="close-auth" id="closeRegister" style="position: absolute; top: 15px; right: 20px; font-size: 2rem; cursor: pointer;">&times;</span>
<h2>Register</h2>
<form id="registerForm">
<input type="text" id="regName" placeholder="Full Name" required>
<input type="email" id="regEmail" placeholder="Email" required>
<input type="password" id="regPassword" placeholder="Password (min 6)" required>
<button type="submit" class="btn btn-primary" style="width: 100%;">Register</button>
</form>
<p style="text-align: center; margin-top: 15px;">Already have an account? <span id="showLogin" style="color: #ff4d6d; cursor: pointer;">Login</span></p>
</div>
</div>

<!-- Quick View Modal -->
<div class="modal" id="quickViewModal">
<div class="modal-content">
<span class="modal-close" id="closeQuickView">&times;</span>
<img src="" alt="" class="modal-img" id="quickViewImg">
<div class="modal-details" id="quickViewDetails"></div>
</div>
</div>

<!-- Size Guide Modal -->
<div class="modal" id="sizeGuideModal">
<div class="modal-content" style="max-width: 500px;">
<span class="modal-close" id="closeSizeGuide">&times;</span>
<h2>Size Guide</h2>
<table>
<tr><th>Size</th><th>Chest (inches)</th><th>Waist (inches)</th></tr>
<tr><td>S</td><td>36-38</td><td>30-32</td></tr>
<tr><td>M</td><td>38-40</td><td>32-34</td></tr>
<tr><td>L</td><td>40-42</td><td>34-36</td></tr>
<tr><td>XL</td><td>42-44</td><td>36-38</td></tr>
</table>
</div>
</div>

<!-- Address Book Modal -->
<div class="modal" id="addressModal">
<div class="modal-content" style="max-width: 500px;">
<span class="modal-close" id="closeAddress">&times;</span>
<h2>My Addresses</h2>
<div id="addressList"></div>
<button class="btn btn-primary" id="addAddressBtn" style="margin-top: 15px;">+ Add New Address</button>
</div>
</div>

<!-- Order History Modal -->
<div class="modal" id="orderModal">
<div class="modal-content" style="max-width: 600px;">
<span class="modal-close" id="closeOrder">&times;</span>
<h2>My Orders</h2>
<div id="orderHistory"></div>
</div>
</div>

<!-- Wishlist Modal -->
<div class="modal" id="wishlistModal">
<div class="modal-content" style="max-width: 600px;">
<span class="modal-close" id="closeWishlist">&times;</span>
<h2>My Wishlist</h2>
<div id="wishlistItems"></div>
</div>
</div>

<!-- Cart Sidebar -->
<div class="modal" id="cartModal" style="justify-content: flex-end;">
<div class="modal-content" style="max-width: 400px; height: 100vh; border-radius: 0; overflow-y: auto;">
<span class="modal-close" id="closeCart">&times;</span>
<h2>Your Cart</h2>
<div id="cartItems"></div>
<div class="cart-total" id="cartTotal" style="font-size: 1.4rem; margin: 20px 0;"></div>
<button class="btn btn-primary" id="checkoutBtn" style="width: 100%;">Proceed to Checkout</button>
</div>
</div>

<script>
  (function() {
    // ---------- ENHANCED PRODUCT DATA ----------
    const products = [
      { id: 1, name: 'Classic Denim Jacket', price: 1499, category: 'jackets', rating: 4.5, reviews: 128, stock: 15, img: 'https://images.unsplash.com/photo-1604644401890-0bd678c83788?w=400&h=500&fit=crop' },
      { id: 2, name: 'Graphic Print T-Shirt', price: 499, category: 'tshirts', rating: 4.3, reviews: 89, stock: 32, img: 'https://images.unsplash.com/photo-1622445275463-afa2ab738c34?w=400&h=500&fit=crop' },
      { id: 3, name: 'Summer Floral Dress', price: 999, category: 'dresses', rating: 4.8, reviews: 56, stock: 8, img: 'https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=400&h=500&fit=crop' },
      { id: 4, name: 'Slim Fit Jeans', price: 1799, category: 'jeans', rating: 4.6, reviews: 203, stock: 0, img: 'https://images.unsplash.com/photo-1542272604-787c3835535d?w=400&h=500&fit=crop' },
      { id: 5, name: 'Oversized Hoodie', price: 1299, category: 'hoodies', rating: 4.7, reviews: 167, stock: 12, img: 'https://images.unsplash.com/photo-1556905055-8f358a7a47b2?w=400&h=500&fit=crop' },
      { id: 6, name: 'Leather Crossbody Bag', price: 2199, category: 'accessories', rating: 4.4, reviews: 42, stock: 5, img: 'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=400&h=500&fit=crop' },
      { id: 7, name: 'Running Shoes', price: 2499, category: 'footwear', rating: 4.9, reviews: 314, stock: 7, img: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=500&fit=crop' },
      { id: 8, name: 'Silk Scarf', price: 799, category: 'accessories', rating: 4.2, reviews: 28, stock: 20, img: 'https://images.unsplash.com/photo-1601924921557-45e39c0d1d60?w=400&h=500&fit=crop' },
      { id: 9, name: 'Leather Jacket', price: 3499, category: 'jackets', rating: 4.9, reviews: 95, stock: 3, img: 'https://images.unsplash.com/photo-1521225601380-42f5311516b2?w=400&h=500&fit=crop' },
      { id: 10, name: 'Polo T-Shirt', price: 699, category: 'tshirts', rating: 4.1, reviews: 73, stock: 45, img: 'https://images.unsplash.com/photo-1576566588028-4147f3842f27?w=400&h=500&fit=crop' }
    ];

    // ---------- USER STATE ----------
    let currentUser = JSON.parse(localStorage.getItem('visaUser')) || null;
    let cart = [];
    let wishlist = [];
    let addresses = [];
    let orders = [];
    let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
    let appliedCoupon = null;

    // Load user-specific data
    if (currentUser) {
      cart = JSON.parse(localStorage.getItem(`cart_${currentUser.email}`)) || [];
      wishlist = JSON.parse(localStorage.getItem(`wishlist_${currentUser.email}`)) || [];
      addresses = JSON.parse(localStorage.getItem(`addresses_${currentUser.email}`)) || [];
      orders = JSON.parse(localStorage.getItem(`orders_${currentUser.email}`)) || [];
    }

    // ---------- DOM ELEMENTS ----------
    const grid = document.getElementById('productGrid');
    const recentlyGrid = document.getElementById('recentlyViewedGrid');
    const guestWarning = document.getElementById('guestWarningPlaceholder');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');

    // ---------- RENDER PRODUCTS with all features ----------
    function renderProducts() {
      let filtered = [...products];

      // Filter by category
      const activeCat = document.querySelector('.category-btn.active')?.dataset.category;
      if (activeCat && activeCat !== 'all') {
        filtered = filtered.filter(p => p.category === activeCat);
      }

      // Filter by search
      const searchTerm = searchInput.value.toLowerCase();
      if (searchTerm) {
        filtered = filtered.filter(p => p.name.toLowerCase().includes(searchTerm));
      }

      // Sort
      const sortBy = sortSelect.value;
      if (sortBy === 'price-low') filtered.sort((a,b) => a.price - b.price);
      if (sortBy === 'price-high') filtered.sort((a,b) => b.price - a.price);
      if (sortBy === 'rating') filtered.sort((a,b) => b.rating - a.rating);

      // Render
      grid.innerHTML = '';
      const loggedIn = !!currentUser;

      if (!loggedIn) {
        guestWarning.innerHTML = '<div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 10px; margin-bottom: 20px;"><i class="fas fa-exclamation-triangle"></i> Please login to add items to cart or wishlist</div>';
      } else {
        guestWarning.innerHTML = '';
      }

      filtered.forEach(p => {
        const inWishlist = wishlist.some(w => w.id === p.id);
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          ${p.stock === 0 ? '<div class="product-badge out-of-stock">Out of Stock</div>' : p.stock < 5 ? '<div class="product-badge">Only ' + p.stock + ' left!</div>' : ''}
<div class="product-img-container">
<img src="${p.img}" alt="${p.name}" class="product-img">
<div class="product-overlay">
<button class="overlay-btn" onclick="quickView(${p.id})"><i class="fas fa-eye"></i></button>
              ${loggedIn && p.stock > 0 ? '<button class="overlay-btn" onclick="addToCart(' + p.id + ')"><i class="fas fa-shopping-cart"></i></button>' : ''}
              ${loggedIn ? '<button class="overlay-btn" onclick="toggleWishlist(' + p.id + ')"><i class="fas fa-heart' + (inWishlist ? '" style="color: #ff4d6d;"' : '') + '"></i></button>' : ''}
</div>
</div>
<div class="product-info">
<div class="product-category">${p.category}</div>
<div class="product-name">${p.name}</div>
<div class="product-rating">
              ${'‚òÖ'.repeat(Math.floor(p.rating))}${p.rating % 1 ? '¬Ω' : ''} <span>(${p.reviews})</span>
</div>
<div class="product-price">‚Çπ${p.price}</div>
</div>
<div class="product-actions">
            ${p.stock > 0 ? 
              `<button class="btn btn-primary" ${!loggedIn ? 'disabled' : ''} onclick="addToCart(${p.id})">Add to Cart</button>` :
              `<button class="btn btn-primary" disabled>Out of Stock</button>`
            }
</div>
        `;
        grid.appendChild(card);
      });

      // Update recently viewed
      renderRecentlyViewed();
    }

    // ---------- RECENTLY VIEWED ----------
    function addToRecentlyViewed(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      recentlyViewed = [product, ...recentlyViewed.filter(p => p.id !== productId)].slice(0, 4);
      localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
      renderRecentlyViewed();
    }

    function renderRecentlyViewed() {
      recentlyGrid.innerHTML = '';
      recentlyViewed.forEach(p => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
<img src="${p.img}" alt="${p.name}" style="width:100%; height:150px; object-fit:cover;">
<div class="product-info">
<div class="product-name">${p.name}</div>
<div class="product-price">‚Çπ${p.price}</div>
</div>
        `;
        card.onclick = () => quickView(p.id);
        recentlyGrid.appendChild(card);
      });
    }

    // ---------- WISHLIST ----------
    window.toggleWishlist = function(productId) {
      if (!currentUser) {
        alert('Please login to use wishlist');
        loginModal.style.display = 'flex';
        return;
      }
      const product = products.find(p => p.id === productId);
      const index = wishlist.findIndex(w => w.id === productId);
      if (index === -1) {
        wishlist.push(product);
      } else {
        wishlist.splice(index, 1);
      }
      localStorage.setItem(`wishlist_${currentUser.email}`, JSON.stringify(wishlist));
      document.getElementById('wishlist-count').textContent = wishlist.length;
      renderProducts(); // refresh heart icons
    };

    // ---------- CART ----------
    window.addToCart = function(productId) {
      if (!currentUser) {
        alert('Please login to add items to cart');
        loginModal.style.display = 'flex';
        return;
      }
      const product = products.find(p => p.id === productId);
      if (product.stock === 0) {
        alert('Out of stock!');
        return;
      }
      const existing = cart.find(i => i.id === productId);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      localStorage.setItem(`cart_${currentUser.email}`, JSON.stringify(cart));
      updateCartUI();
      addToRecentlyViewed(productId);
    };

    function updateCartUI() {
      document.getElementById('cart-count').textContent = cart.reduce((s,i) => s + i.quantity, 0);
      renderCartItems();
    }

    function renderCartItems() {
      const container = document.getElementById('cartItems');
      if (!container) return;
      if (cart.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888;">Your cart is empty</p>';
        document.getElementById('cartTotal').textContent = 'Total: ‚Çπ0';
        return;
      }
      let html = '', total = 0;
      cart.forEach(item => {
        total += item.price * item.quantity;
        html += `
<div style="display:flex; gap:10px; margin-bottom:15px; border-bottom:1px solid #ddd; padding-bottom:10px;">
<img src="${item.img}" style="width:60px; height:60px; object-fit:cover; border-radius:5px;">
<div style="flex:1">
<div><strong>${item.name}</strong></div>
<div>‚Çπ${item.price} x ${item.quantity}</div>
<div style="display:flex; gap:5px; margin-top:5px;">
<button onclick="changeQty(${item.id}, -1)" class="btn" style="padding:2px 10px;">-</button>
<button onclick="changeQty(${item.id}, 1)" class="btn" style="padding:2px 10px;">+</button>
<button onclick="removeFromCart(${item.id})" style="background:none; border:none; color:#ff4d6d;"><i class="fas fa-trash"></i></button>
</div>
</div>
</div>
        `;
      });
      container.innerHTML = html;
      document.getElementById('cartTotal').textContent = `Total: ‚Çπ${total}`;
    }

    window.changeQty = function(productId, delta) {
      const idx = cart.findIndex(i => i.id === productId);
      if (idx === -1) return;
      cart[idx].quantity += delta;
      if (cart[idx].quantity <= 0) cart.splice(idx, 1);
      localStorage.setItem(`cart_${currentUser.email}`, JSON.stringify(cart));
      updateCartUI();
    };

    window.removeFromCart = function(productId) {
      cart = cart.filter(i => i.id !== productId);
      localStorage.setItem(`cart_${currentUser.email}`, JSON.stringify(cart));
      updateCartUI();
    };

    // ---------- QUICK VIEW ----------
    window.quickView = function(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      addToRecentlyViewed(productId);
      document.getElementById('quickViewImg').src = product.img;
      document.getElementById('quickViewDetails').innerHTML = `
<h2>${product.name}</h2>
<div class="product-rating" style="margin:10px 0;">
          ${'‚òÖ'.repeat(Math.floor(product.rating))}${product.rating % 1 ? '¬Ω' : ''} (${product.reviews} reviews)
</div>
<p class="product-price" style="font-size:1.8rem;">‚Çπ${product.price}</p>
<p style="margin:10px 0;">Category: ${product.category}</p>
<p>Stock: ${product.stock > 0 ? product.stock + ' units' : 'Out of Stock'}</p>
        ${product.stock > 0 && currentUser ? 
          `<button class="btn btn-primary" onclick="addToCart(${product.id}); document.getElementById('quickViewModal').style.display='none';">Add to Cart</button>` : 
          product.stock === 0 ? '<button class="btn btn-primary" disabled>Out of Stock</button>' : 
          '<button class="btn btn-primary" onclick="document.getElementById(\'loginModal\').style.display=\'flex\';">Login to Buy</button>'
        }
      `;
      document.getElementById('quickViewModal').style.display = 'flex';
    };

    // ---------- COUPON ----------
    document.getElementById('applyCoupon')?.addEventListener('click', () => {
      const code = document.getElementById('couponInput').value;
      if (code.toUpperCase() === 'WELCOME20') {
        appliedCoupon = { code: 'WELCOME20', discount: 20 };
        document.getElementById('couponMessage').innerHTML = '<span style="color: #fff;">‚úÖ Coupon applied! 20% off</span>';
      } else {
        document.getElementById('couponMessage').innerHTML = '<span style="color: #fff;">‚ùå Invalid coupon</span>';
      }
    });

    // ---------- ADDRESS BOOK ----------
    function renderAddresses() {
      const list = document.getElementById('addressList');
      if (!list) return;
      list.innerHTML = addresses.map((addr, i) => `
<div class="address-card">
<p><strong>${addr.name}</strong> (${addr.phone})</p>
<p>${addr.address}, ${addr.city} - ${addr.pincode}</p>
<button onclick="deleteAddress(${i})" style="background:none; border:none; color:#ff4d6d;">Delete</button>
</div>
      `).join('');
    }

    window.deleteAddress = function(index) {
      addresses.splice(index, 1);
      localStorage.setItem(`addresses_${currentUser.email}`, JSON.stringify(addresses));
      renderAddresses();
    };

    document.getElementById('addAddressBtn')?.addEventListener('click', () => {
      const addr = {
        name: prompt('Full Name:'),
        phone: prompt('Phone:'),
        address: prompt('Address:'),
        city: prompt('City:'),
        pincode: prompt('Pincode:')
      };
      if (addr.name && addr.phone) {
        addresses.push(addr);
        localStorage.setItem(`addresses_${currentUser.email}`, JSON.stringify(addresses));
        renderAddresses();
      }
    });

    // ---------- ORDER HISTORY ----------
    function renderOrders() {
      const container = document.getElementById('orderHistory');
      if (!container) return;
      if (orders.length === 0) {
        container.innerHTML = '<p>No orders yet</p>';
        return;
      }
      container.innerHTML = orders.map(order => `
<div class="tracking-card">
<p><strong>Order #${order.id}</strong> - ${order.date}</p>
<p>Total: ‚Çπ${order.total} | Status: <span style="color:#28a745;">${order.status}</span></p>
<div class="tracking-steps">
<div class="step ${order.status !== 'pending' ? 'active' : ''}"><div class="step-icon"><i class="fas fa-check"></i></div>Placed</div>
<div class="step ${order.status === 'shipped' || order.status === 'delivered' ? 'active' : ''}"><div class="step-icon"><i class="fas fa-box"></i></div>Shipped</div>
<div class="step ${order.status === 'delivered' ? 'active' : ''}"><div class="step-icon"><i class="fas fa-home"></i></div>Delivered</div>
</div>
</div>
      `).join('');
    }

    // ---------- CHECKOUT ----------
    document.getElementById('checkoutBtn')?.addEventListener('click', () => {
      if (!currentUser) {
        alert('Please login to checkout');
        return;
      }
      if (cart.length === 0) {
        alert('Cart is empty');
        return;
      }

      // Create order
      const order = {
        id: 'ORD' + Date.now(),
        date: new Date().toLocaleDateString(),
        items: [...cart],
        total: cart.reduce((s,i) => s + i.price * i.quantity, 0),
        status: 'pending',
        coupon: appliedCoupon
      };

      orders.unshift(order);
      localStorage.setItem(`orders_${currentUser.email}`, JSON.stringify(orders));

      // WhatsApp message
      let msg = 'üõçÔ∏è *NEW ORDER*%0A%0A';
      cart.forEach(i => { msg += `‚Ä¢ ${i.name} ${i.quantity}x ‚Çπ${i.price*i.quantity}%0A`; });
      msg += `%0aüîπ SUBTOTAL: ‚Çπ${order.total}%0A`;
      if (appliedCoupon) msg += `üî∏ Coupon: ${appliedCoupon.code} (${appliedCoupon.discount}% off)%0A`;
      msg += `üë§ Customer: ${currentUser.name} (${currentUser.email})%0A`;

      window.open(`https://wa.me/917558407044?text=${msg}`, '_blank');

      // Clear cart
      cart = [];
      localStorage.setItem(`cart_${currentUser.email}`, JSON.stringify(cart));
      updateCartUI();
      alert('Order placed! Check WhatsApp for confirmation.');
    });

    // ---------- AUTH ----------
    const loginModal = document.getElementById('loginModal');
    const registerModal = document.getElementById('registerModal');
    const userIcon = document.getElementById('userIcon');
    const userNameSpan = document.getElementById('userNameDisplay');

    function updateUserUI() {
      if (currentUser) {
        userNameSpan.textContent = currentUser.name.split(' ')[0];
        userIcon.style.background = '#ff4d6d';
      } else {
        userNameSpan.textContent = 'Login';
        userIcon.style.background = '#333';
        cart = [];
        wishlist = [];
      }
      document.getElementById('cart-count').textContent = cart.length;
      document.getElementById('wishlist-count').textContent = wishlist.length;
      renderProducts();
    }

    userIcon.addEventListener('click', () => {
      if (currentUser) {
        if (confirm(`Logged in as ${currentUser.name}. Logout?`)) {
          localStorage.removeItem('visaUser');
          currentUser = null;
          updateUserUI();
        }
      } else {
        loginModal.style.display = 'flex';
      }
    });

    // Login
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const pass = document.getElementById('loginPassword').value;
      const users = JSON.parse(localStorage.getItem('visaUsers')) || [];
      const user = users.find(u => u.email === email && u.password === pass);
      if (user) {
        currentUser = { name: user.name, email: user.email };
        localStorage.setItem('visaUser', JSON.stringify(currentUser));

        // Load user data
        cart = JSON.parse(localStorage.getItem(`cart_${currentUser.email}`)) || [];
        wishlist = JSON.parse(localStorage.getItem(`wishlist_${currentUser.email}`)) || [];
        addresses = JSON.parse(localStorage.getItem(`addresses_${currentUser.email}`)) || [];
        orders = JSON.parse(localStorage.getItem(`orders_${currentUser.email}`)) || [];

        updateUserUI();
        loginModal.style.display = 'none';
        alert(`Welcome back, ${user.name}!`);
      } else {
        alert('Invalid credentials');
      }
    });

    // Register
    document.getElementById('registerForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('regName').value;
      const email = document.getElementById('regEmail').value;
      const pass = document.getElementById('regPassword').value;

      if (pass.length < 6) {
        alert('Password must be at least 6 characters');
        return;
      }

      const users = JSON.parse(localStorage.getItem('visaUsers')) || [];
      if (users.find(u => u.email === email)) {
        alert('Email already exists');
        return;
      }

      users.push({ name, email, password: pass });
      localStorage.setItem('visaUsers', JSON.stringify(users));

      // Auto login
      currentUser = { name, email };
      localStorage.setItem('visaUser', JSON.stringify(currentUser));
      cart = []; wishlist = []; addresses = []; orders = [];

      updateUserUI();
      registerModal.style.display = 'none';
      alert('Registration successful!');
    });

    // Modal controls
    document.getElementById('closeLogin').onclick = () => loginModal.style.display = 'none';
    document.getElementById('closeRegister').onclick = () => registerModal.style.display = 'none';
    document.getElementById('showRegister').onclick = () => { loginModal.style.display = 'none'; registerModal.style.display = 'flex'; };
    document.getElementById('showLogin').onclick = () => { registerModal.style.display = 'none'; loginModal.style.display = 'flex'; };

    document.getElementById('closeQuickView').onclick = () => document.getElementById('quickViewModal').style.display = 'none';
    document.getElementById('closeCart').onclick = () => document.getElementById('cartModal').style.display = 'none';
    document.getElementById('closeWishlist').onclick = () => document.getElementById('wishlistModal').style.display = 'none';
    document.getElementById('closeAddress').onclick = () => document.getElementById('addressModal').style.display = 'none';
    document.getElementById('closeOrder').onclick = () => document.getElementById('orderModal').style.display = 'none';
    document.getElementById('closeSizeGuide').onclick = () => document.getElementById('sizeGuideModal').style.display = 'none';

    // Category filter
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        renderProducts();
      });
    });

    // Size guide
    document.getElementById('sizeGuideBtn').addEventListener('click', () => {
      document.getElementById('sizeGuideModal').style.display = 'flex';
    });

    // Wishlist icon
    document.getElementById('wishlistIcon').addEventListener('click', () => {
      if (!currentUser) {
        alert('Please login to view wishlist');
        loginModal.style.display = 'flex';
        return;
      }
      const container = document.getElementById('wishlistItems');
      container.innerHTML = wishlist.map(p => `
<div style="display:flex; gap:10px; margin-bottom:10px; border-bottom:1px solid #ddd; padding:10px;">
<img src="${p.img}" style="width:50px; height:50px; object-fit:cover;">
<div style="flex:1">
<strong>${p.name}</strong><br>
            ‚Çπ${p.price}
</div>
<button onclick="addToCart(${p.id}); toggleWishlist(${p.id});" class="btn btn-primary btn-sm">Move to Cart</button>
</div>
      `).join('');
      document.getElementById('wishlistModal').style.display = 'flex';
    });

    // Cart icon
    document.getElementById('cartIcon').addEventListener('click', () => {
      if (!currentUser) {
        alert('Please login to view cart');
        loginModal.style.display = 'flex';
        return;
      }
      renderCartItems();
      document.getElementById('cartModal').style.display = 'flex';
    });

    // Search and sort
    searchInput.addEventListener('input', renderProducts);
    sortSelect.addEventListener('change', renderProducts);

    // Address book (user menu could have it - adding simple user menu items)
    // For demo, we'll add a hidden menu, but you can expand

    // Initialize
    updateUserUI();
    renderRecentlyViewed();
  })();
</script>
</body>
</html>
